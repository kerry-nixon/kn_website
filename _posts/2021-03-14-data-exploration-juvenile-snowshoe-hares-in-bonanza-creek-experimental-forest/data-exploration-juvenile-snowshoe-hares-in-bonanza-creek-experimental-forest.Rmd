---
title: "Data Exploration: Juvenile Snowshoe Hares in Bonanza Creek Experimental Forest"
description: |
  This exploration of juvenile snowshoe hare data was produced as an assignment for Professor Allison Horst's ESM 206 Data Science course. Completed: 11/17/2020
author:
  - name: Kerry Nixon
    url: {}
date: 03-14-2021
output:
  distill::distill_article:
    self_contained: false
    code_folding: 'hide'
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE) #Excluding code, messages, and warnings from knitted document

# Attaching packages
library(tidyverse)
library(lubridate)
library(janitor)
library(here)
library(effsize)
library(broom)
library(ggbeeswarm)
library(kableExtra)

# Reading in the data
hares_data <- read.csv(here("_posts/2021-03-14-data-exploration-juvenile-snowshoe-hares-in-bonanza-creek-experimental-forest/data/bonanza_hares.csv"))
```

### Introduction

This study is an exploration of data generated by Kielland et al. that explored the population fluctuations and body conditions of snowshoe hares, Lepus americanus, over a period of thirteen years in Interior Alaska. Snowshoe hares were selected for study because they are a 'keystone' prey species in northern boreal forests with important effects on vegetation and predator populations. In this report, we focus on data collected for juvenile snowshoe hares. To examine various aspects of population fluctuation and body condition variables we explore the annual counts of juvenile hares over the course of the study, visualize juvenile hare weights by sex and capture site, compare the mean weights of male and female juveniles, and explore the relationship between hind foot length and weight. See the following section for details about the data and methods used.


### Data and Analyses

Data was collected by Knut Kielland and collegues who conducted capture-recapture studies of snowshoe hares at 5 locations in the Tanana valley of the Bonanza Creek Experimental Forest in Interior Alaska. The data contain observations for 3197 hare trappings, collected from 1999 through 2012. We started by filtering for the 378 juvenile hare observations. We did not include observations that list age as NA, as this would have introduced unneccesary noise into the data through the potential inclusion of hares that were older than the juvenile age range. A beeswarm plot was used to visualize snowshoe juvenile weight disaggretaed by sex and trap location. Boxplots are overlaying the observation data to visualize the summary statistics for the plotted data. Following exploratory data visualization, a Welch two-sample t-test using a significance level ($\alpha$) of 0.05 was used to compare male and female juvenile snowshoe hare weights. Differences between groups are described by Cohen's *d* effect size. The relationship between hind foot length and weight is explored with a scatter plot visualization and by simple linear regression. All analyses are in R version 4.0.2 using RStudio Version 1.3.1093. 


### Exploratory Findings

#### I. Annual juvenile hare trap counts. 

```{r}
# Data wrangling

# Filtering for observations of juveniles, using `lubridate()` package to reformat dates and pull out the year, and mutate(case_when()) to create columns with updated trap location names and use the full word to denote sex.
hares_juv <- hares_data %>% 
  filter(age == "j") %>% 
  mutate(date_ymd = mdy(date),
         year = year(date_ymd)) %>% 
  mutate(site = case_when(
    grid == "bonrip" ~ "Riparian",
    grid == "bonbs" ~ "Black Spruce",
    grid == "bonmat" ~ "Mature Forest")) %>% 
  mutate(sex_full = case_when(
    sex == "f" ~ "female",
    sex == "m" ~ "male",
    sex == "NA" ~ "NA"))

# Using `count()` to count total number hares observed each year
juv_counts <- hares_juv %>% 
  count(year)

# Expanding the summary table to include the years where no confirmed juveniles were trapped and observed (2002, 2009), using full_seq() and right_join() to create a table with the missing years, and complete() to add zeros for those years. Code-Credit: Hannah Brady
juv_yrs_add <- juv_counts %>% 
  expand(year = full_seq(year,1)) 
juv_yrs <- right_join(juv_counts, juv_yrs_add, by = c("year"))
juv_count_all_yrs <- juv_yrs %>% 
  complete(juv_yrs, fill = list(n = 0))

```


```{r}
# Hare Count by Year Data Viz
ggplot(data = hares_juv, aes(x = year)) +
  geom_histogram(binwidth = 1) +
  scale_x_continuous(breaks = c(1999,2002,2005,2008,2011)) +
  scale_y_continuous(limits = c(0,130)) +
  labs(x = "\nYear",
       y = "Total Number of Hares Counted\n",
       title = "Juvenile Hare Count by Year (1999-2012)\n",
       caption = str_wrap("Figure 1. Juvenile Hare Counts by Year. The total number of juvenile hares caught in traps are shown for every year of the study. Data: Kielland et al.", width = 100)) +
  theme(
    plot.caption = element_text(hjust = 0), # move caption to the left
    plot.title = element_text(hjust = 0.5, face = "bold")) # move title to center and bold

```


**Table 1.** Juvenile Hare Count Summary Table (1999-2012). This table includes summary statistics (mean, median, maximum and minimum) for the number of juvenile hares caught in traps during a given study period for a particular year. Summary stats were calculated using the total count from each year over the entire course of the study. Data: Kielland et al.

```{r}

# Summary statistic table
juvenile_summary <- juv_count_all_yrs %>% 
  summarize(mean_count = mean(n),
            median_count = median(n),
            minimum_count = min(n),
            maximum_count = max(n))
kable(juvenile_summary, col.names = c("Mean Count", "Median Count", "Minimum Count", "Maximum Count")) %>% 
  kable_styling(full_width = FALSE, "striped")

# Creating values for the summary statistics for ease of use in in-line text referencing
n <- juv_count_all_yrs %>% 
  pull(n)

juv_mean <- mean(n)
juv_median <- median(n)
juv_max <- max(n)
juv_min <- min(n)

```


##### Analysis
The maximum juvenile hares counted in a a year was `r (juv_max)` in 1999. The minimum juvenile hares counted in a year was `r (juv_min)` in 2002 and 2009. While some hares were trapped those years, the ages were not confirmed and recorded in the data, and so those observations were excluded to avoid unnecessary noise. The mean count of juvenile hares in a given year was `r (juv_mean)`, and the median count was `r (juv_median)`. Juvenile hare counts peaked in 1999 with an overall decrease in counts over time, as visualized in **Figure 1**. As is shown in both **Figure 1** and **Table 1** the year to year hare counts vary drastically. Summary statistics are included in **Table 2**. The years with no juveniles counted greatly reduced the mean, while the maximum count increased the mean. For these reasons median count may provide a slightly more appropriate measure of central tendency than the mean. 

Counts are affected by effort, namely the number of days spent collecting observations each year and the number of traps used. Future analysis could standardize annual counts by creating a hare trap count per unit of effort. This would be accomplished by multiplying the number of days spent making observations by the number of traps used to create the unit of effort, and then dividing the hare count total for each year by this value. The values generated would be hare count per trap per day for each year. 


#### II. Exploring juvenile hare weights by sex and trap location. 

```{r, preview = TRUE}

ggplot(data = hares_juv, aes(x = sex_full, y = weight)) +
  geom_beeswarm(aes(color = sex_full),
                alpha = 0.5,
                show.legend = FALSE) +
  facet_wrap(~ site) +
  scale_color_manual(values = c("goldenrod2","cyan4"),
                     na.value = "coral") +
  geom_boxplot(fill = NA, width = 0.5, outlier.color = NA, mean = "red") +
  stat_summary(fun.y=mean, geom="point", shape=20, size=2) +
  theme_minimal() +
  labs(x = "\nSex\n",
       y = "Hare Weight (g)\n",
       title = "Juvenile Hare Weight by Sex and Site\n",
       caption = str_wrap("Figure 2. Juvenile Hare Weight by Sex and Site. Juvenile snowshoe hare weights in grams are plotted by sex and trap location. The trap sites are located in three different zones in the Tanana Valley of Bonanza Experimental Forest, Alaska. Box plots are graphed on top of observation points showing the data quartiles. The median is rendered as a thick horizontal bar. The mean is shown as a black dot. Data: Kielland et al.", width = 100)) +
  theme(
    plot.caption = element_text(hjust = 0), # move caption to the left
    plot.title = element_text(hjust = 0.5, face = "bold")) # move title to center and bold

```


##### Analysis
By plotting hare weight by sex and trap site (see **Figure 2**), a few patterns emerge that may warrant further exploration in future analysis. The greatest number of juveniles of both sexes were observed in the Riparian area of the Tanana valley. The least number of juveniles were observed in the lowland Black Spruce stand. Where sex was not determined (denoted as NA) the weight(g) of the hare tends to be a lesser value, particularly in the Riparian area. This may indicate that the youngest and smallest juveniles had fewer features of sexual differentiation, but this is beyond the scope of this paper and would need to be explored further in future analysis. The medians and means of of male juveniles were greater than the means and medians of female juveniles in all three locations. We will examine whether this represents a significant difference in the next section of this report. 

#### III. Comparison of mean male & female juvenile snowshoe hare weights. 


```{r}
# Pulling male and female hare weights as vectors and saving the vectors as objects
m_hares <- hares_juv %>% 
  filter(sex == "m") %>% 
  pull(weight)

f_hares <- hares_juv %>% 
  filter(sex == "f") %>% 
  pull(weight)

```


```{r, include = FALSE}
# Exploratory histograms & qq-plots to check assumptions for t-test

hist(m_hares) # Has two peaks, a lot of observations around 500 g (lower value end)
qqnorm(m_hares) # Not fully linear- deviation at mid to low and mid to high values...not fully normal
hist(f_hares) # Possibly a bit positively skewed
qqnorm(f_hares) # Looks fairly linear

# t-test assumptions check: There is general normality and due to sample size the Central Limit Theorem will hold for the means, despite some slight deviations from normality within the sample distributions. Two-sample t-test OK for means comparison. 

```

**Table 3.** Juvenile Hare Weight by Sex Summary Table. The mean weight(g) and standard deviation(g) are shown for male and female juvenile hares, as well as for juveniles of undetermined sex. Data: Kielland et al.

```{r}

# Summary Table with means, SDs & sample sizes for each: 
hares_summary <- hares_juv %>% 
  group_by(sex_full) %>% 
  summarize(mean_weight = round(mean(weight, na.rm = TRUE),2),
            sd_weight = round(sd(weight, na.rm = TRUE),2),
            sample_size = n())

kable(hares_summary, col.names = c("Sex", "Mean weight (g)", "Standard deviation (g)", "Sample size")) %>% 
  kable_styling(full_width = FALSE, "striped")

# Saving percent difference as a value for use in inline referencing
mu_percent_diff <- round(((hares_summary$mean_weight[2] - hares_summary$mean_weight[1]) /
                            (mean(hares_summary$mean_weight[2] +
                                    hares_summary$mean_weight[1]))) *100, 2)
```


```{r}
# t-test:
sex_weight_ttest <- t.test(m_hares, f_hares)

# Tidy model results to call outputs in-line: 
sex_weight_ttest_tidy <- tidy(sex_weight_ttest)

# Effect size: 
sex_effsize <- cohen.d(m_hares, f_hares, na.rm = TRUE) # There is no tidy() or glance() method for objects of class effsize

```

##### Analysis 
In this section we explore the relationship between juvenile hare weight and sex, by first examining the summary statistics shown in **Table 3** and then performing a two sample t-test. The difference in mean weight of male juveniles versus female juveniles was `r round(sex_weight_ttest_tidy$estimate,2)`(g) which is a `r mu_percent_diff` percent difference. The t-test found a significant difference between the mean weights of male and female juvenile hares (*t* = `r round(sex_weight_ttest_tidy$statistic,2)`, *p* = `r round(sex_weight_ttest_tidy$p.value,2)`); however, the actual difference and the effect size were small (Cohen's *d* = 0.29). This may indicate a marginal difference in the average size of male versus femal snowshoe hares during the juvenlie life stage, despite a finding of statistically significant difference. 

#### IV. Exploring the relationship between juvenile weight & hind foot length. 

```{r}
ggplot(data = hares_juv, aes(x = hindft, y = weight)) +
  geom_point( size = 2) +
  theme_minimal() +
  labs(x = "\nHind Foot Length (mm)\n",
       y = "Weight (g)\n",
       title = "Juvenile Weight and Hind Foot Length\n",
       caption = str_wrap("Figure 3. Juvenile Hare Weight by Hind Foot Length. Juvenile snowshoe hare weights in grams are plotted against hind foot length in milimeters. Data: Kielland et al.", width = 100)) +
  theme(
    plot.caption = element_text(hjust = 0), # move caption to the left
    plot.title = element_text(hjust = 0.5, face = "bold")) # move title to center and bold")

```



```{r}
# Linear regression
hares_lm <- lm(weight ~ hindft, data = hares_juv)

# See full lm statistics with summary(), and save as an object
hares_lm_summ <- summary(hares_lm)

# Get tidy versions of the model output to call later on in text
hares_lm_tidy <- tidy(hares_lm)
hares_lm_glance <- glance(hares_lm)

```

```{r, include= FALSE}
# See model diagnostics to check linear regression assumptions:
hares_lm_plot <- plot(hares_lm)
```

```{r}
# Get Pearson's r correlation
hare_cor <- cor.test(hares_juv$weight, hares_juv$hindft)

# Tidy version of correlation output:
hare_cor_tidy <- tidy(hare_cor)
```


##### Analysis
The exploratory scatter plot showing juvenile hare weight(g) versus hind foot length(mm) shows that there appears to be some sort of relationship between the two variables that looks roughly linear. To explore this further we ran a linear regression with weight (g) as a function of hind foot length (mm). According to the linear model we would expect that on average the weight of a snowshoe hare to increase by `r round(hares_lm_tidy$estimate[2],2)`grams for every millimeter increase in hind foot length. The coefficient of determination is (R^2 = `r round(hares_lm_glance$r.squared,3)`), meaning that `r round(hares_lm_glance$r.squared,2)*100 `% of the variance in weight (g) is predicted by hind foot size (mm). The Pearson's *r* = `r round(hare_cor_tidy$estimate,2)`, indicating a moderate positive correlation with respect to hind foot length (mm) as a predictor of weight (g). However, when plotting the model's residuals we find that there is a clear trend of increased variance in residuals as they move towards greater values, indicating that heteroscedasticity may be an issue. Additionally, in a QQplot, the residuals appear to fall below the predicted value at lower values and above the predicted value at greater values, indicating that the residuals are not normally distributed. Taking these two factors into account, it seems that the relationship between weight and hid foot length may not be linear and a different model may be more appropriate. 


### Summary

- The juvenile snowshoe hare population peaked in 1999 and generally declined over the course of the study.

- The most juvenile hares were observed in the riparian region of the Tanana Valley

- The effect size of sex on weight is small (Cohen's *d* = 0.29), despite the difference in mean weight between male and female juveniles being statistically significant (*p* = `r round(sex_weight_ttest_tidy$p.value,2)`).


### Citations

Kielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. Snowshoe hare physical data in Bonanza Creek Experimental Forest: 1999-Present ver 22. Environmental Data Initiative. https://doi.org/10.6073/pasta/03dce4856d79b91557d8e6ce2cbcdc14 (Accessed 2020-11-18). 


